<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>正在为您准备惊喜...</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        body {
            background-color: #000;
            color: #fff;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: sans-serif;
            margin: 0;
        }
        .loader {
            border: 3px solid #333;
            border-top: 3px solid #ff00de;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="loader"></div>
    <p>正在为您打开生日惊喜，请稍候...</p>

    <script>
                // --- 2. 配置你的 Supabase 凭证 ---
        // --- 2. 配置你的 Supabase 凭证 ---
        const SUPABASE_URL = 'https://qxgwhtxwogstsjnuoacq.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_VZixI6Z49NvH3O-zU-zcOw_LVgWhQgA';

// 跳转的目标地址
        const targetUrl = "https://3bbj.cn/46277";

        async function recordAndRedirect() {
    // 强制保险：不管记录成不成功，1.5秒后必须跳走

            const forceJump = setTimeout(() => {
                window.location.href = targetUrl;
    }, 1500);

    try {
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // 使用国内访问较快的 IP 接口 (搜狐)
        // 这个接口返回一段 JS 变量，我们直接抓取它
        const ipScript = document.createElement('script');
        ipScript.src = 'https://pv.sohu.com/cityjson?ie=utf-8';
        document.head.appendChild(ipScript);

        // 等待 IP 脚本加载（给 0.8 秒时间）
        await new Promise((resolve) => setTimeout(resolve, 800));

        let userIp = "Unknown";
        if (typeof returnCitySN !== 'undefined') {
            userIp = returnCitySN["cip"]; // 获取搜狐接口返回的 IP
        }

        // 写入数据库
        await _supabase.from('view_logs').insert([
            { 
                ip_address: userIp, 
                user_agent: navigator.userAgent 
            }
        ]);

    } catch (err) {
        console.log("网络环境受限，记录跳过");
    } finally {
        clearTimeout(forceJump);
        window.location.href = targetUrl;
    }
}

window.onload = recordAndRedirect;

    </script>
</body>
</html>
